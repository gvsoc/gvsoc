from gvtest.testsuite import *
from functools import partial

def tests_build(testset):

    tests = [
        '10x1x32x32_fs1',
        '10x1x32x32_fs1',
        '1x1x1x1_fs3_qw8',
        '1x1x28x32_st1_fs3',
        '1x1x32x1_woffs1_fs3',
        '1x1x35x35_ns1_nb1_dw_fs3',
        '1x9x1x1_fs3',
        '3x3x1x36_fs3',
        '3x3x32x36_fs3',
        '6x6x32x32_fs3',
        '6x6x38x6_fs1',
        '7x8x33x33_dw_fs3_fmask_1_0_0_0',
        '7x8x38x35_qw7_fs3',
        '8x7x35x35_ns1_nb1_dw_fs3',
        'neureka_multi_cluster',
        '10x9x36x37_fs1',
        '1x1x28x1_qw7_fs3',
        '1x1x29x29_fs3_dw',
        '1x1x32x32_ns1_nb0_fs3',
        '1x1x36x1_qw7_fs1',
        '28x28x12x7_fs3_dw',
        '3x3x28x1_fs3',
        '3x3x35x35_dw_fs3',
        '6x6x32x33_fs3_pad7_2_2_2_2',
        '7x7x36x36_fs1_relu',
        '7x8x33x33_fs3_fmask_1_0_0_0',
        '7x8x38x38_qw7_dw',
        '9x10x32x32_fs3',
        '1x1x1x1_fs1',
        '1x1x28x1_st1_fs3',
        '1x1x32x1_fs1',
        '1x1x32x36_st1_fs3',
        '1x1x38x1_fs1',
        '28x28x7x7_fs3_dw1',
        '3x3x28x28_dw_fs3',
        '6x6x1x1_fs3_pad3_2_2_2_2',
        '6x6x32x36_fs3',
        '7x7x36x36_fs3_dw_relu',
        '7x8x33x33_woffs1_dw_fs3',
        '7x8x38x38_qw7_fs1',
        '9x10x35x35_fs3_dw',
        '1x1x1x1_fs3_fmask_1_1_1_1',
        '1x1x28x1_woffs1_fs3',
        '1x1x32x1_qw7_fs1',
        '1x1x32x39_woffs1_fs3',
        '1x7x1x1_fs3_dw',
        '29x29x12x13_fs3_dw',
        '3x3x32x1_fs3',
        '6x6x28x1_st1_fs3',
        '6x6x32x6_fs1',
        '7x7x36x36_fs3_relu',
        '7x8x33x33_woffs1_fs1',
        '8x10x35x37_ns1_nb1_fs1',
        'neureka_L1_patch',
        '1x1x1x1_fs3_pad3_2_2_2_2',
        '1x1x28x28_ns1_nb1_dw_fs3',
        '1x1x32x1_st1_fs3',
        '1x1x32x6_fs1',
        '1x7x29x29_fs3_dw',
        '3x3x1x1_dw_fs3',
        '3x3x32x32_fs3',
        '6x6x29x29_fs3_dw',
        '6x6x33x33_fs3_dw_pad7_2_2_2_2',
        '7x8x32x39_woffs1_fs3',
        '7x8x37x37_st1_fs1',
        '8x7x33x35_ns1_nb1_fs3',
        'neureka_L1_patch_debug'
    ]
    skipped_tests = [
        '1x1x28x1_qw7_fs3',
    ]

    for test_name in tests:
        cwd = testset.get_path()
        test = testset.new_make_test(test_name, flags=f'build_dir_ext={test_name}', path=f'{cwd}/pulp-sdk-siracusa/tests/neureka/{test_name}')

        if test_name in skipped_tests:
            test.skip('Failing, to be fixed')


def testset_build(testset):

    testset.set_name('pulp-sdk-siracusa')
    testset.add_target('siracusa',
    '''{
        "sourceme": "os.path.join(os.environ.get(\\"SIRACUSA_SDK_HOME\\"), \\"configs\\", \\"siracusa.sh\\")"
    }''')
    testset.add_testset(callback=partial(tests_build))
