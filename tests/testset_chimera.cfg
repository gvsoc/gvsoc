from plptest.testsuite import *
import re
import os

def tests_build(testset):

    tests = [
        'test_host_returnZero', 'test_host_printf', 'test_snitchCluster_simpleOffload'
    ]

    skipped_tests = [
        ['test_host_alloc', 'Test broken'],
        ['test_host_uartSimple', 'Seems uart is not yet supported on Gvsoc']
    ]

    for test_name in tests:
        test = testset.new_test(test_name)
        cwd = testset.get_path()
        work_dir = f'{cwd}/chimera-sdk/work/{test_name}'
        test.add_command(Shell('run', f'gvsoc --target chimera --work {work_dir} --binary {cwd}/chimera-sdk/build/bin/{test_name} run'))

    for test_desc in skipped_tests:
        test = testset.new_test(test_desc[0])
        test.skip(test_desc[1])


def testset_build(testset):

    testset.set_name('chimera-sdk')

    testset.add_target('chimera')

    testset.add_testset(callback=tests_build)
