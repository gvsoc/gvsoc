from plptest.testsuite import *
import re
import os

def testset_build(testset):

    testset.set_name('chimera-sdk')

    testset.add_target('chimera', '{}')

    tests = [
        'test_host_returnZero', 'test_host_printf', 'test_host_returnZero', 'test_snitchCluster_simpleOffload'
    ]

    for test_name in tests:
        test = testset.new_test(test_name)
        cwd = testset.get_path()
        work_dir = f'{cwd}/chimera-sdk/work/{test_name}'
        os.makedirs(work_dir, exist_ok=True)
        test.add_command(Shell('run', f'gvsoc --target chimera --work {work_dir} --binary {cwd}/chimera-sdk/build/bin/{test_name} run'))
